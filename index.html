<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <!-- Panel CSS: must match the panel wheel version installed below -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@holoviz/panel@1.8.3/dist/panel.min.css" />

  <!-- Bokeh JS (core + widgets + tables) - must match the bokeh wheel version -->
  <script src="https://cdn.bokeh.org/bokeh/release/bokeh-3.8.1.min.js"></script>
  <script src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.8.1.min.js"></script>
  <script src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.8.1.min.js"></script>

  <!-- Panel runtime JS -->
  <script src="https://cdn.jsdelivr.net/npm/@holoviz/panel@1.8.3/dist/panel.min.js"></script>

  <title>Panel + Pyodide App</title>
  <link rel="stylesheet" href="static/styles.css" />
</head>

<body>
  <!-- Loading splash (visible while Pyodide / wheels download) -->
  <div id="loading">
    <div>
      ⏳ Loading Python runtime and Panel…<br />
      <small id="loading-detail">Initializing</small>
    </div>
  </div>

  <!-- Panel will render into this -->
  <div class="app-grid" role="application">
    <div id="sidebar" aria-label="Sidebar placeholder">
      <!-- Panel will mount here -->
    </div>

    <header id="topbar">
      <h3 style="margin:0;">My Dashboard</h3>
    </header>

    <main id="main" role="main">
      <!-- Panel will mount main content here -->
    </main>

    <footer id="footer">
      © H. Leitte 2025 — <a href="https://github.com/YOUR_REPO" target="_blank">GitHub repo</a>
    </footer>
  </div>

  <!-- Pyodide (WASM) loader -->
  <script src="https://cdn.jsdelivr.net/pyodide/v0.28.2/full/pyodide.js"></script>

  <script>
    async function boot() {
      const ld = document.getElementById("loading-detail");
      try {
        ld.innerText = "Loading Pyodide (WebAssembly)…";
        const pyodide = await loadPyodide({ indexURL: "https://cdn.jsdelivr.net/pyodide/v0.28.2/full/" });

        ld.innerText = "Installing micropip & Panel/Bokeh wheels…";
        // load micropip then install the Panel/Bokeh wheels (versions must match the HTML above)
        await pyodide.loadPackage("micropip");
        const micropip = pyodide.pyimport("micropip");

        // Install holoviz wheels (these are the smaller prebuilt wheels recommended for web)
        await micropip.install([
          "https://cdn.holoviz.org/panel/wheels/bokeh-3.8.1-py3-none-any.whl",
          "https://cdn.holoviz.org/panel/wheels/panel-1.8.3-py3-none-any.whl",
          "holoviews==1.21.0"
        ]);

        ld.innerText = "Fetching and starting the app…";

        const resp = await fetch("main.py");
        if (!resp.ok) throw new Error("Failed to fetch main.py: " + resp.status);
        const code = await resp.text();

        // run the app (main.py should await pn.io.pyodide.write(...))
        await pyodide.runPythonAsync(code);

        // hide the loading splash — the app should be visible now
        document.getElementById("loading").style.display = "none";
      } catch (err) {
        console.error("Boot failed:", err);
        document.getElementById("loading-detail").innerText = "Failed to start (see console)";
      }
    }

    boot();
  </script>
</body>

</html>